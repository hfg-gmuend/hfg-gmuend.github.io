import{a as L,t as W,c as F}from"../chunks/disclose-version.DxMZbUI2.js";import{p as j,d as o,Q as S,R as G,c as M,s as p,r as T,t as H,g as t,a as K,S as r,l as J,$ as N,T as V,f as X}from"../chunks/runtime.ClRJlCNk.js";import{s as Y,e as C}from"../chunks/render.b59hm30d.js";import{p as z,b as P,i as Z}from"../chunks/props.BYbcvqXF.js";import{s as E,m as tt,p as et,k as at}from"../chunks/image.BKtIEOmZ.js";import{i as O}from"../chunks/lifecycle.guE77-il.js";import{o as Q,a as q}from"../chunks/index-client.BwMEAalH.js";import{s as ot,a as U}from"../chunks/store.KJ42LqRP.js";import{f as st,a as nt,b as rt,c as it,d as ct}from"../chunks/store.CqvlEMML.js";var lt=W('<container class="svelte-12dhsk2"><img class="image svelte-12dhsk2"> <div class="control svelte-12dhsk2"><img class="controlnet svelte-12dhsk2"> <div class="clip svelte-12dhsk2"> </div></div></container>');function mt(x,f){j(f,!1);const s=ot(),i=()=>U(it,"$controlnetModule",s),l=()=>U(ct,"$controlnetModel",s),b=r();let n=z(f,"image",12),m=z(f,"captureTime",8),e=r(!1),v=r(),c=r("");const I=async()=>{o(c,await st(n()))},$=async()=>{o(v,await nt(n(),i()))},k=async()=>{let h=Date.now(),a=t(c);n(await rt({image:n(),prompt:a,input_image:t(v),mask:tt,controlnetModel:l(),guidance_end:.9})),console.log("Time taken in seconds: "+(Date.now()-h)/1e3+"s")},y=async()=>{t(e)&&(await $(),t(e)&&(await I(),t(e)&&(await k(),t(e)&&(await new Promise(h=>setTimeout(h,10)),y()))))};Q(()=>{n()&&(o(e,!0),y())}),q(()=>{o(e,!1)}),S(()=>J(m()),()=>{m()||(console.log("captureTime not set"),o(e,!1))}),S(()=>t(c),()=>{o(b,1e4/t(c).length+10)}),G(),O();var g=lt(),d=M(g),w=p(d,2),_=M(w),u=p(_,2),D=M(u);T(u),T(w),T(g),H(()=>{E(d,"src",n()),E(_,"src",t(v)),E(u,"style",`font-size: ${t(b)??""}px;`),Y(D,t(c))}),L(x,g),K()}var dt=W('<main><video autoplay muted class="webcam svelte-imo2ut"></video> <canvas width="512" height="512" class="svelte-imo2ut"></canvas> <!> <button class="svelte-imo2ut">start</button> <button class="svelte-imo2ut">stop</button></main>');function kt(x,f){j(f,!1);let s=r(),i,l=r(),b=1024,n=1024,m=r(),e=r(),v=3e3;const c=async()=>{try{i=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:b,height:n}}),V(s,t(s).srcObject=i)}catch(a){console.error("Error accessing webcam:",a)}},I=()=>{i&&(i.getTracks().forEach(a=>a.stop()),i=null)};Q(()=>{c()}),q(()=>{I()});const $=()=>(t(l).getContext("2d").drawImage(t(s),0,0,512,512),t(l).toDataURL("image/png")),k=async()=>{o(m,$()),o(e,+new Date)},y=()=>{o(e,null)},g=a=>{if(a.key==="w"){if(t(e)&&+new Date-t(e)<v)return;console.log("# w pressen new"),k()}};O();var d=dt();C("keydown",N,et(g));var w=M(d);P(w,a=>o(s,a),()=>t(s));var _=p(w,2);P(_,a=>o(l,a),()=>t(l));var u=p(_,2);Z(u,()=>t(m),a=>{var R=F(),A=X(R);at(A,()=>t(e),B=>{mt(B,{get image(){return t(m)},get captureTime(){return t(e)}})}),L(a,R)});var D=p(u,2),h=p(D,2);T(d),C("click",D,k),C("click",h,y),L(x,d),K()}export{kt as component};

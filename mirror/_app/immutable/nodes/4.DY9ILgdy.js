import{a as L,t as W,c as F}from"../chunks/disclose-version.DxMZbUI2.js";import{p as j,d as o,Q as S,R as G,c as M,s as p,r as T,t as H,g as e,a as A,S as r,l as J,$ as N,T as V,f as X}from"../chunks/runtime.ClRJlCNk.js";import{s as Y,e as R}from"../chunks/render.b59hm30d.js";import{p as z,b as P,i as Z}from"../chunks/props.BYbcvqXF.js";import{s as C,m as ee,p as te,k as ae}from"../chunks/image.BKtIEOmZ.js";import{i as K}from"../chunks/lifecycle.guE77-il.js";import{o as O,a as Q}from"../chunks/index-client.BwMEAalH.js";import{s as oe,a as U}from"../chunks/store.KJ42LqRP.js";import{f as se,a as ne,e as re,c as ie,d as ce}from"../chunks/store.CqvlEMML.js";var le=W('<container class="svelte-12dhsk2"><img class="image svelte-12dhsk2"> <div class="control svelte-12dhsk2"><img class="controlnet svelte-12dhsk2"> <div class="clip svelte-12dhsk2"> </div></div></container>');function me(x,f){j(f,!1);const s=oe(),i=()=>U(ie,"$controlnetModule",s),l=()=>U(ce,"$controlnetModel",s),b=r();let n=z(f,"image",12),m=z(f,"captureTime",8),t=r(!1),v=r(),c=r("");const I=async()=>{o(c,await se(n()))},$=async()=>{o(v,await ne(n(),i()))},k=async()=>{let h=Date.now(),a=e(c);n(await re({prompt:a,image:n(),input_image:e(v),mask:ee,controlnetModel:l(),sampler_index:"Euler a",steps:20,guidance_end:.9})),console.log("Time taken in seconds: "+(Date.now()-h)/1e3+"s")},y=async()=>{e(t)&&(await $(),e(t)&&(await I(),e(t)&&(await k(),e(t)&&(await new Promise(h=>setTimeout(h,10)),y()))))};O(()=>{n()&&(o(t,!0),y())}),Q(()=>{o(t,!1)}),S(()=>J(m()),()=>{m()||(console.log("captureTime not set"),o(t,!1))}),S(()=>e(c),()=>{o(b,1e4/e(c).length+10)}),G(),K();var g=le(),u=M(g),w=p(u,2),_=M(w),d=p(_,2),D=M(d);T(d),T(w),T(g),H(()=>{C(u,"src",n()),C(_,"src",e(v)),C(d,"style",`font-size: ${e(b)??""}px;`),Y(D,e(c))}),L(x,g),A()}var ue=W('<main><video autoplay muted class="webcam svelte-imo2ut"></video> <canvas width="512" height="512" class="svelte-imo2ut"></canvas> <!> <button class="svelte-imo2ut">start</button> <button class="svelte-imo2ut">stop</button></main>');function ke(x,f){j(f,!1);let s=r(),i,l=r(),b=1024,n=1024,m=r(),t=r(),v=3e3;const c=async()=>{try{i=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:b,height:n}}),V(s,e(s).srcObject=i)}catch(a){console.error("Error accessing webcam:",a)}},I=()=>{i&&(i.getTracks().forEach(a=>a.stop()),i=null)};O(()=>{c()}),Q(()=>{I()});const $=()=>(e(l).getContext("2d").drawImage(e(s),0,0,512,512),e(l).toDataURL("image/png")),k=async()=>{o(m,$()),o(t,+new Date)},y=()=>{o(t,null)},g=a=>{if(a.key==="a"){if(e(t)&&+new Date-e(t)<v)return;console.log("# w pressen new"),k()}};K();var u=ue();R("keydown",N,te(g));var w=M(u);P(w,a=>o(s,a),()=>e(s));var _=p(w,2);P(_,a=>o(l,a),()=>e(l));var d=p(_,2);Z(d,()=>e(m),a=>{var E=F(),q=X(E);ae(q,()=>e(t),B=>{me(B,{get image(){return e(m)},get captureTime(){return e(t)}})}),L(a,E)});var D=p(d,2),h=p(D,2);T(u),R("click",D,k),R("click",h,y),L(x,u),A()}export{ke as component};
